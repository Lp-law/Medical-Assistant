{"ast":null,"code":"const MEDICAL_QUALITY_WEIGHTS = {\n  Complete: -2,\n  Partial: 3,\n  Poor: 7\n};\nconst STANCE_WEIGHTS = {\n  None: 0,\n  Defense: -5,\n  Plaintiff: 5\n};\nexport const calculateLiabilityScore = (baselineProbability, aggravatingFactors, mitigatingFactors, medicalRecordQuality, expertCourtStance) => {\n  let probability = baselineProbability + (aggravatingFactors - mitigatingFactors) * 5 + MEDICAL_QUALITY_WEIGHTS[medicalRecordQuality] + STANCE_WEIGHTS[expertCourtStance];\n  probability = Math.max(1, Math.min(99, probability));\n  const range = [Math.max(0, probability - 12), Math.min(100, probability + 12)];\n  const spread = range[1] - range[0];\n  const uncertainty = spread <= 20 ? 'Low' : spread <= 30 ? 'Medium' : 'High';\n  return {\n    probability,\n    range,\n    uncertainty\n  };\n};\nexport const calculateHeadValue = (head, damages) => {\n  var _head$parameters;\n  if (!head.isActive) return 0;\n  const baseLoss = Math.max(0, damages.wagePreInjury - damages.wagePostInjury);\n  const disabilityFactor = 1 + damages.permanentDisabilityFunctional / 100;\n  const durationFactor = 1 + damages.daysOfHospitalization / 365;\n  const multiplier = typeof ((_head$parameters = head.parameters) === null || _head$parameters === void 0 ? void 0 : _head$parameters.multiplier) === 'number' ? head.parameters.multiplier : 1;\n  const manualAmount = Number.isFinite(head.calculatedAmount) ? head.calculatedAmount : 0;\n  const derivedAmount = baseLoss * disabilityFactor * durationFactor * 12;\n  return Math.round(Math.max(manualAmount, derivedAmount) * multiplier);\n};\nexport const calculateMPL = damages => {\n  const baseIncomeLoss = Math.max(0, damages.wagePreInjury - damages.wagePostInjury);\n  const horizonYears = Math.max(1, damages.lifeExpectancy - damages.currentAge);\n  const disabilityRatio = damages.permanentDisabilityFunctional / 100;\n  const incomeComponent = baseIncomeLoss * 12 * horizonYears * disabilityRatio;\n  const headsComponent = damages.heads.reduce((sum, head) => sum + calculateHeadValue(head, damages), 0);\n  const interestFactor = 1 + damages.interestRate / 100;\n  return Math.round(Math.max(0, (incomeComponent + headsComponent) * interestFactor));\n};","map":{"version":3,"names":["MEDICAL_QUALITY_WEIGHTS","Complete","Partial","Poor","STANCE_WEIGHTS","None","Defense","Plaintiff","calculateLiabilityScore","baselineProbability","aggravatingFactors","mitigatingFactors","medicalRecordQuality","expertCourtStance","probability","Math","max","min","range","spread","uncertainty","calculateHeadValue","head","damages","_head$parameters","isActive","baseLoss","wagePreInjury","wagePostInjury","disabilityFactor","permanentDisabilityFunctional","durationFactor","daysOfHospitalization","multiplier","parameters","manualAmount","Number","isFinite","calculatedAmount","derivedAmount","round","calculateMPL","baseIncomeLoss","horizonYears","lifeExpectancy","currentAge","disabilityRatio","incomeComponent","headsComponent","heads","reduce","sum","interestFactor","interestRate"],"sources":["C:/Office-Apps/LexMedical-App/src/services/calculations.ts"],"sourcesContent":["import {\r\n  DamagesData,\r\n  DamagesHead,\r\n  ExpertStance,\r\n  MedicalRecordQuality,\r\n  UncertaintyLevel,\r\n} from '../types';\r\n\r\nexport interface LiabilityScoreResult {\r\n  probability: number;\r\n  range: [number, number];\r\n  uncertainty: UncertaintyLevel;\r\n}\r\n\r\nconst MEDICAL_QUALITY_WEIGHTS: Record<MedicalRecordQuality, number> = {\r\n  Complete: -2,\r\n  Partial: 3,\r\n  Poor: 7,\r\n};\r\n\r\nconst STANCE_WEIGHTS: Record<ExpertStance, number> = {\r\n  None: 0,\r\n  Defense: -5,\r\n  Plaintiff: 5,\r\n};\r\n\r\nexport const calculateLiabilityScore = (\r\n  baselineProbability: number,\r\n  aggravatingFactors: number,\r\n  mitigatingFactors: number,\r\n  medicalRecordQuality: MedicalRecordQuality,\r\n  expertCourtStance: ExpertStance,\r\n): LiabilityScoreResult => {\r\n  let probability =\r\n    baselineProbability +\r\n    (aggravatingFactors - mitigatingFactors) * 5 +\r\n    MEDICAL_QUALITY_WEIGHTS[medicalRecordQuality] +\r\n    STANCE_WEIGHTS[expertCourtStance];\r\n\r\n  probability = Math.max(1, Math.min(99, probability));\r\n  const range: [number, number] = [Math.max(0, probability - 12), Math.min(100, probability + 12)];\r\n  const spread = range[1] - range[0];\r\n  const uncertainty: UncertaintyLevel = spread <= 20 ? 'Low' : spread <= 30 ? 'Medium' : 'High';\r\n\r\n  return { probability, range, uncertainty };\r\n};\r\n\r\nexport const calculateHeadValue = (head: DamagesHead, damages: DamagesData): number => {\r\n  if (!head.isActive) return 0;\r\n  const baseLoss = Math.max(0, damages.wagePreInjury - damages.wagePostInjury);\r\n  const disabilityFactor = 1 + damages.permanentDisabilityFunctional / 100;\r\n  const durationFactor = 1 + damages.daysOfHospitalization / 365;\r\n  const multiplier =\r\n    typeof head.parameters?.multiplier === 'number' ? (head.parameters.multiplier as number) : 1;\r\n  const manualAmount = Number.isFinite(head.calculatedAmount) ? head.calculatedAmount : 0;\r\n  const derivedAmount = baseLoss * disabilityFactor * durationFactor * 12;\r\n  return Math.round(Math.max(manualAmount, derivedAmount) * multiplier);\r\n};\r\n\r\nexport const calculateMPL = (damages: DamagesData): number => {\r\n  const baseIncomeLoss = Math.max(0, damages.wagePreInjury - damages.wagePostInjury);\r\n  const horizonYears = Math.max(1, damages.lifeExpectancy - damages.currentAge);\r\n  const disabilityRatio = damages.permanentDisabilityFunctional / 100;\r\n  const incomeComponent = baseIncomeLoss * 12 * horizonYears * disabilityRatio;\r\n  const headsComponent = damages.heads.reduce((sum, head) => sum + calculateHeadValue(head, damages), 0);\r\n  const interestFactor = 1 + damages.interestRate / 100;\r\n  return Math.round(Math.max(0, (incomeComponent + headsComponent) * interestFactor));\r\n};\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}