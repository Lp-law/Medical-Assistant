{"ast":null,"code":"const MEDICAL_QUALITY_WEIGHTS={Complete:-2,Partial:3,Poor:7};const STANCE_WEIGHTS={None:0,Defense:-5,Plaintiff:5};export const calculateLiabilityScore=(baselineProbability,aggravatingFactors,mitigatingFactors,medicalRecordQuality,expertCourtStance)=>{let probability=baselineProbability+(aggravatingFactors-mitigatingFactors)*5+MEDICAL_QUALITY_WEIGHTS[medicalRecordQuality]+STANCE_WEIGHTS[expertCourtStance];probability=Math.max(1,Math.min(99,probability));const range=[Math.max(0,probability-12),Math.min(100,probability+12)];const spread=range[1]-range[0];const uncertainty=spread<=20?'Low':spread<=30?'Medium':'High';return{probability,range,uncertainty};};export const calculateHeadValue=(head,damages)=>{var _head$parameters;if(!head.isActive)return 0;const baseLoss=Math.max(0,damages.wagePreInjury-damages.wagePostInjury);const disabilityFactor=1+damages.permanentDisabilityFunctional/100;const durationFactor=1+damages.daysOfHospitalization/365;const multiplier=typeof((_head$parameters=head.parameters)===null||_head$parameters===void 0?void 0:_head$parameters.multiplier)==='number'?head.parameters.multiplier:1;const manualAmount=Number.isFinite(head.calculatedAmount)?head.calculatedAmount:0;const derivedAmount=baseLoss*disabilityFactor*durationFactor*12;return Math.round(Math.max(manualAmount,derivedAmount)*multiplier);};export const calculateMPL=damages=>{const baseIncomeLoss=Math.max(0,damages.wagePreInjury-damages.wagePostInjury);const horizonYears=Math.max(1,damages.lifeExpectancy-damages.currentAge);const disabilityRatio=damages.permanentDisabilityFunctional/100;const incomeComponent=baseIncomeLoss*12*horizonYears*disabilityRatio;const headsComponent=damages.heads.reduce((sum,head)=>sum+calculateHeadValue(head,damages),0);const interestFactor=1+damages.interestRate/100;return Math.round(Math.max(0,(incomeComponent+headsComponent)*interestFactor));};","map":{"version":3,"names":["MEDICAL_QUALITY_WEIGHTS","Complete","Partial","Poor","STANCE_WEIGHTS","None","Defense","Plaintiff","calculateLiabilityScore","baselineProbability","aggravatingFactors","mitigatingFactors","medicalRecordQuality","expertCourtStance","probability","Math","max","min","range","spread","uncertainty","calculateHeadValue","head","damages","_head$parameters","isActive","baseLoss","wagePreInjury","wagePostInjury","disabilityFactor","permanentDisabilityFunctional","durationFactor","daysOfHospitalization","multiplier","parameters","manualAmount","Number","isFinite","calculatedAmount","derivedAmount","round","calculateMPL","baseIncomeLoss","horizonYears","lifeExpectancy","currentAge","disabilityRatio","incomeComponent","headsComponent","heads","reduce","sum","interestFactor","interestRate"],"sources":["C:/Office-Apps/LexMedical-App/src/services/calculations.ts"],"sourcesContent":["import {\r\n  DamagesData,\r\n  DamagesHead,\r\n  ExpertStance,\r\n  MedicalRecordQuality,\r\n  UncertaintyLevel,\r\n} from '../types';\r\n\r\nexport interface LiabilityScoreResult {\r\n  probability: number;\r\n  range: [number, number];\r\n  uncertainty: UncertaintyLevel;\r\n}\r\n\r\nconst MEDICAL_QUALITY_WEIGHTS: Record<MedicalRecordQuality, number> = {\r\n  Complete: -2,\r\n  Partial: 3,\r\n  Poor: 7,\r\n};\r\n\r\nconst STANCE_WEIGHTS: Record<ExpertStance, number> = {\r\n  None: 0,\r\n  Defense: -5,\r\n  Plaintiff: 5,\r\n};\r\n\r\nexport const calculateLiabilityScore = (\r\n  baselineProbability: number,\r\n  aggravatingFactors: number,\r\n  mitigatingFactors: number,\r\n  medicalRecordQuality: MedicalRecordQuality,\r\n  expertCourtStance: ExpertStance,\r\n): LiabilityScoreResult => {\r\n  let probability =\r\n    baselineProbability +\r\n    (aggravatingFactors - mitigatingFactors) * 5 +\r\n    MEDICAL_QUALITY_WEIGHTS[medicalRecordQuality] +\r\n    STANCE_WEIGHTS[expertCourtStance];\r\n\r\n  probability = Math.max(1, Math.min(99, probability));\r\n  const range: [number, number] = [Math.max(0, probability - 12), Math.min(100, probability + 12)];\r\n  const spread = range[1] - range[0];\r\n  const uncertainty: UncertaintyLevel = spread <= 20 ? 'Low' : spread <= 30 ? 'Medium' : 'High';\r\n\r\n  return { probability, range, uncertainty };\r\n};\r\n\r\nexport const calculateHeadValue = (head: DamagesHead, damages: DamagesData): number => {\r\n  if (!head.isActive) return 0;\r\n  const baseLoss = Math.max(0, damages.wagePreInjury - damages.wagePostInjury);\r\n  const disabilityFactor = 1 + damages.permanentDisabilityFunctional / 100;\r\n  const durationFactor = 1 + damages.daysOfHospitalization / 365;\r\n  const multiplier =\r\n    typeof head.parameters?.multiplier === 'number' ? (head.parameters.multiplier as number) : 1;\r\n  const manualAmount = Number.isFinite(head.calculatedAmount) ? head.calculatedAmount : 0;\r\n  const derivedAmount = baseLoss * disabilityFactor * durationFactor * 12;\r\n  return Math.round(Math.max(manualAmount, derivedAmount) * multiplier);\r\n};\r\n\r\nexport const calculateMPL = (damages: DamagesData): number => {\r\n  const baseIncomeLoss = Math.max(0, damages.wagePreInjury - damages.wagePostInjury);\r\n  const horizonYears = Math.max(1, damages.lifeExpectancy - damages.currentAge);\r\n  const disabilityRatio = damages.permanentDisabilityFunctional / 100;\r\n  const incomeComponent = baseIncomeLoss * 12 * horizonYears * disabilityRatio;\r\n  const headsComponent = damages.heads.reduce((sum, head) => sum + calculateHeadValue(head, damages), 0);\r\n  const interestFactor = 1 + damages.interestRate / 100;\r\n  return Math.round(Math.max(0, (incomeComponent + headsComponent) * interestFactor));\r\n};\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}