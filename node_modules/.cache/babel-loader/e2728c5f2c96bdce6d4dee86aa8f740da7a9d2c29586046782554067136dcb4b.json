{"ast":null,"code":"import React,{useMemo,useState}from'react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const initialModalState={open:false,loading:false,error:null,source:null,claimTitle:''};const formatDate=value=>{if(!value)return'-';const parsed=new Date(value);if(Number.isNaN(parsed.getTime()))return value;return parsed.toLocaleDateString('he-IL');};const KnowledgeClaimsPanel=_ref=>{var _modal$source$lineRan;let{claims,limit=5}=_ref;const[showAll,setShowAll]=useState(false);const[modal,setModal]=useState(initialModalState);const visibleClaims=useMemo(()=>showAll?claims:claims.slice(0,limit),[claims,showAll,limit]);const handleOpenSource=claim=>{var _claim$source;if(!((_claim$source=claim.source)!==null&&_claim$source!==void 0&&_claim$source.snippet)){setModal({open:true,loading:false,error:'מקור לא זמין',source:null,claimTitle:claim.type});return;}setModal({open:true,loading:false,error:null,source:claim.source,claimTitle:claim.type});};const closeModal=()=>setModal(initialModalState);if(!claims.length){return/*#__PURE__*/_jsx(\"div\",{className:\"rounded border border-slate-200 bg-white p-4 text-sm text-slate-500\",children:\"\\u05DC\\u05D0 \\u05D0\\u05D5\\u05EA\\u05E8\\u05D5 \\u05D8\\u05E2\\u05E0\\u05D5\\u05EA \\u05E8\\u05E4\\u05D5\\u05D0\\u05D9\\u05D5\\u05EA \\u05D1\\u05DE\\u05E1\\u05DE\\u05DA \\u05D6\\u05D4.\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"rounded border border-slate-200 bg-white\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between border-b border-slate-200 px-4 py-3\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-bold text-slate-700\",children:\"\\u05D8\\u05E2\\u05E0\\u05D5\\u05EA \\u05E8\\u05E4\\u05D5\\u05D0\\u05D9\\u05D5\\u05EA\"}),claims.length>limit&&/*#__PURE__*/_jsx(\"button\",{className:\"text-xs text-blue-600 hover:text-blue-800\",onClick:()=>setShowAll(prev=>!prev),children:showAll?'הצג פחות':'צפה בכול'})]}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full text-sm\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-slate-50 text-slate-500\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2 text-right font-semibold\",children:\"\\u05E1\\u05D5\\u05D2\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2 text-right font-semibold\",children:\"\\u05E2\\u05E8\\u05DA\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2 text-right font-semibold\",children:\"\\u05EA\\u05D0\\u05E8\\u05D9\\u05DA\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2 text-right font-semibold\",children:\"\\u05D0\\u05DE\\u05D9\\u05E0\\u05D5\\u05EA\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2 text-right font-semibold\",children:\"\\u05DE\\u05E7\\u05D5\\u05E8\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:visibleClaims.map(claim=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-t border-slate-100\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2 whitespace-nowrap\",children:claim.type}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2\",children:claim.value}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2 whitespace-nowrap\",children:formatDate(claim.date)}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2\",children:claim.confidence?\"\".concat(Math.round(claim.confidence*100),\"%\"):'—'}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2 text-left\",children:/*#__PURE__*/_jsx(\"button\",{className:\"text-xs text-blue-600 hover:text-blue-800\",onClick:()=>handleOpenSource(claim),children:\"\\u05DE\\u05E7\\u05D5\\u05E8\"})})]},claim.id))})]})}),modal.open&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 z-40 flex items-center justify-center bg-black/40 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"w-full max-w-lg rounded bg-white p-6 shadow-xl\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3 flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-bold text-slate-700\",children:modal.claimTitle||'מקור'}),/*#__PURE__*/_jsx(\"button\",{onClick:closeModal,className:\"text-sm text-slate-500 hover:text-slate-900\",children:\"\\u05E1\\u05D2\\u05D5\\u05E8\"})]}),modal.loading&&/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-slate-500\",children:\"\\u05D8\\u05D5\\u05E2\\u05DF \\u05DE\\u05E7\\u05D5\\u05E8...\"}),!modal.loading&&modal.error&&/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-rose-600\",children:modal.error}),!modal.loading&&!modal.error&&modal.source&&/*#__PURE__*/_jsxs(\"div\",{className:\"rounded border border-slate-200 bg-slate-50 p-4 text-sm text-slate-700\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"mb-2 whitespace-pre-line\",children:modal.source.snippet}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-slate-500\",children:[modal.source.page?\"\\u05E2\\u05DE\\u05D5\\u05D3 \".concat(modal.source.page):'',(_modal$source$lineRan=modal.source.lineRange)!==null&&_modal$source$lineRan!==void 0&&_modal$source$lineRan.length?\" \\xB7 \\u05E9\\u05D5\\u05E8\\u05D4 \".concat(modal.source.lineRange[0]):'']})]})]})})]});};export default KnowledgeClaimsPanel;","map":{"version":3,"names":["React","useMemo","useState","jsx","_jsx","jsxs","_jsxs","initialModalState","open","loading","error","source","claimTitle","formatDate","value","parsed","Date","Number","isNaN","getTime","toLocaleDateString","KnowledgeClaimsPanel","_ref","_modal$source$lineRan","claims","limit","showAll","setShowAll","modal","setModal","visibleClaims","slice","handleOpenSource","claim","_claim$source","snippet","type","closeModal","length","className","children","onClick","prev","map","date","confidence","concat","Math","round","id","page","lineRange"],"sources":["C:/Office-Apps/LexMedical-App/src/components/KnowledgeClaimsPanel.tsx"],"sourcesContent":["import React, { useMemo, useState } from 'react';\r\nimport { KnowledgeClaim, KnowledgeClaimSource } from '../types';\r\n\r\ninterface Props {\r\n  claims: KnowledgeClaim[];\r\n  limit?: number;\r\n}\r\n\r\ninterface ModalState {\r\n  open: boolean;\r\n  loading: boolean;\r\n  error: string | null;\r\n  source: KnowledgeClaimSource | null;\r\n  claimTitle: string;\r\n}\r\n\r\nconst initialModalState: ModalState = {\r\n  open: false,\r\n  loading: false,\r\n  error: null,\r\n  source: null,\r\n  claimTitle: '',\r\n};\r\n\r\nconst formatDate = (value?: string) => {\r\n  if (!value) return '-';\r\n  const parsed = new Date(value);\r\n  if (Number.isNaN(parsed.getTime())) return value;\r\n  return parsed.toLocaleDateString('he-IL');\r\n};\r\n\r\nconst KnowledgeClaimsPanel: React.FC<Props> = ({ claims, limit = 5 }) => {\r\n  const [showAll, setShowAll] = useState(false);\r\n  const [modal, setModal] = useState<ModalState>(initialModalState);\r\n\r\n  const visibleClaims = useMemo(() => (showAll ? claims : claims.slice(0, limit)), [claims, showAll, limit]);\r\n\r\n  const handleOpenSource = (claim: KnowledgeClaim) => {\r\n    if (!claim.source?.snippet) {\r\n      setModal({\r\n        open: true,\r\n        loading: false,\r\n        error: 'מקור לא זמין',\r\n        source: null,\r\n        claimTitle: claim.type,\r\n      });\r\n      return;\r\n    }\r\n    setModal({\r\n      open: true,\r\n      loading: false,\r\n      error: null,\r\n      source: claim.source,\r\n      claimTitle: claim.type,\r\n    });\r\n  };\r\n\r\n  const closeModal = () => setModal(initialModalState);\r\n\r\n  if (!claims.length) {\r\n    return (\r\n      <div className=\"rounded border border-slate-200 bg-white p-4 text-sm text-slate-500\">\r\n        לא אותרו טענות רפואיות במסמך זה.\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"rounded border border-slate-200 bg-white\">\r\n      <div className=\"flex items-center justify-between border-b border-slate-200 px-4 py-3\">\r\n        <h3 className=\"text-sm font-bold text-slate-700\">טענות רפואיות</h3>\r\n        {claims.length > limit && (\r\n          <button className=\"text-xs text-blue-600 hover:text-blue-800\" onClick={() => setShowAll((prev) => !prev)}>\r\n            {showAll ? 'הצג פחות' : 'צפה בכול'}\r\n          </button>\r\n        )}\r\n      </div>\r\n      <div className=\"overflow-x-auto\">\r\n        <table className=\"min-w-full text-sm\">\r\n          <thead className=\"bg-slate-50 text-slate-500\">\r\n            <tr>\r\n              <th className=\"px-4 py-2 text-right font-semibold\">סוג</th>\r\n              <th className=\"px-4 py-2 text-right font-semibold\">ערך</th>\r\n              <th className=\"px-4 py-2 text-right font-semibold\">תאריך</th>\r\n              <th className=\"px-4 py-2 text-right font-semibold\">אמינות</th>\r\n              <th className=\"px-4 py-2 text-right font-semibold\">מקור</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {visibleClaims.map((claim) => (\r\n              <tr key={claim.id} className=\"border-t border-slate-100\">\r\n                <td className=\"px-4 py-2 whitespace-nowrap\">{claim.type}</td>\r\n                <td className=\"px-4 py-2\">{claim.value}</td>\r\n                <td className=\"px-4 py-2 whitespace-nowrap\">{formatDate(claim.date)}</td>\r\n                <td className=\"px-4 py-2\">{claim.confidence ? `${Math.round(claim.confidence * 100)}%` : '—'}</td>\r\n                <td className=\"px-4 py-2 text-left\">\r\n                  <button\r\n                    className=\"text-xs text-blue-600 hover:text-blue-800\"\r\n                    onClick={() => handleOpenSource(claim)}\r\n                  >\r\n                    מקור\r\n                  </button>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      {modal.open && (\r\n        <div className=\"fixed inset-0 z-40 flex items-center justify-center bg-black/40 p-4\">\r\n          <div className=\"w-full max-w-lg rounded bg-white p-6 shadow-xl\">\r\n            <div className=\"mb-3 flex items-center justify-between\">\r\n              <h4 className=\"font-bold text-slate-700\">{modal.claimTitle || 'מקור'}</h4>\r\n              <button onClick={closeModal} className=\"text-sm text-slate-500 hover:text-slate-900\">\r\n                סגור\r\n              </button>\r\n            </div>\r\n            {modal.loading && <div className=\"text-sm text-slate-500\">טוען מקור...</div>}\r\n            {!modal.loading && modal.error && <div className=\"text-sm text-rose-600\">{modal.error}</div>}\r\n            {!modal.loading && !modal.error && modal.source && (\r\n              <div className=\"rounded border border-slate-200 bg-slate-50 p-4 text-sm text-slate-700\">\r\n                <p className=\"mb-2 whitespace-pre-line\">{modal.source.snippet}</p>\r\n                <div className=\"text-xs text-slate-500\">\r\n                  {modal.source.page ? `עמוד ${modal.source.page}` : ''}\r\n                  {modal.source.lineRange?.length ? ` · שורה ${modal.source.lineRange[0]}` : ''}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default KnowledgeClaimsPanel;\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}